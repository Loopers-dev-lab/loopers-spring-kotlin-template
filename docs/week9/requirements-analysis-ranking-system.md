
# 요구사항 분석 문서: 랭킹 시스템

## 1. 프로젝트 개요

### 1.1 해결하고자 하는 문제

상품에 대한 사용자 행동(조회, 좋아요, 주문)을 종합하여 인기 상품 랭킹을 제공하고자 한다.

### 1.2 프로젝트 목표

조회, 좋아요, 주문 등 사용자 행동을 집계하여 인기 상품 랭킹을 제공한다. 구매자는 인기 상품을 쉽게 탐색할 수 있고, 관리자는 랭킹 정책을 유연하게 조절할 수 있다.

### 1.3 기대 효과

인기 상품 노출을 통한 구매 전환율 향상과 트렌드 반영으로 사용자 경험을 개선한다.

### 1.4 프로젝트 완성 조건

본 프로젝트는 다음 조건을 모두 만족할 때 완성된 것으로 간주한다.

첫째, 모든 유스케이스(US-1 ~ US-3)의 인수 조건을 통과해야 한다. 둘째, 모든 비기능 요구사항(섹션 5)의 조건을 만족해야 한다. 셋째, 검증 시나리오(섹션 6)가 모두 성공해야 한다.

---

## 2. 도메인 용어집

| 용어 | 정의 |
|-----|-----|
| 인기도 | 조회, 좋아요, 주문 등 사용자 행동을 종합하여 산출한 상품의 인기 지표 |
| 랭킹 | 인기도를 기준으로 매겨진 상품 순위 |
| 시간대 | 인기도를 집계하는 시간 단위. 1시간 단위로 구분됨 (예: 14시 시간대, 15시 시간대) |
| 가중치 | 인기도 계산 시 각 행동(조회/좋아요/주문)에 부여하는 중요도. 0에서 1 사이의 값 |
| 인기도 점수 | 가중치를 적용하여 계산된 상품별 인기도 수치 |

### 2.1 사용자 행동 정의

시스템이 추적하는 사용자 행동을 정의한다.

**조회:** 구매자가 상품 상세 페이지에 진입할 때 발생한다. 같은 사용자가 여러 번 조회해도 모두 집계한다.

**좋아요:** 구매자가 상품에 좋아요를 누를 때 발생한다. 좋아요를 취소하면 차감한다.

**주문:** 구매자가 상품을 주문하고 결제를 완료할 때 발생한다. 주문 취소나 환불이 발생해도 차감하지 않는다. 결제 완료 자체가 강한 구매 의도이기 때문이다.

### 2.2 비즈니스 규칙

**인기도 계산:**

인기도 점수는 조회 횟수, 좋아요 수, 주문 금액에 각각의 가중치를 곱한 뒤 합산하여 계산한다.

**주문은 금액 기준:**

주문은 건수가 아닌 금액을 기준으로 인기도를 계산한다. 1,000원짜리 100개보다 100,000원짜리 1개가 더 높은 인기도를 받아야 매출 기여도와 일치하기 때문이다.

**기본 가중치:**

가중치가 별도로 설정되지 않은 경우 조회 0.10, 좋아요 0.20, 주문 0.60을 적용한다. 주문이 가장 강한 구매 의도 시그널이고 조회는 가장 약하기 때문이다.

**최신 트렌드 우선:**

최근 시간대의 행동이 과거 시간대의 행동보다 인기도에 더 큰 영향을 미친다. 이를 통해 "지금 뜨는" 상품이 상위에 노출된다.

**인기도 이월:**

시간대가 바뀔 때 이전 시간대의 인기도 일부가 새 시간대로 이월된다. 이월 비율은 현재 10%이며, 운영 상황에 따라 조절될 수 있다.

**계산 예시:**

상품 A가 조회 100회, 좋아요 10개, 주문 금액 5,000원일 때 기본 가중치를 적용하면 인기도 점수는 (100 × 0.10) + (10 × 0.20) + (5,000 × 0.60) = 3,012점이다.

---

## 3. 주요 사용자와 목표

### 3.1 구매자

구매자는 인기 상품 랭킹을 조회하여 구매할 상품을 탐색하고, 관심 있는 상품이 얼마나 인기 있는지 순위로 확인하고자 한다.

### 3.2 관리자

관리자는 항목별 가중치를 조절하여 구매 전환을 최대화하는 최적의 가중치 조합을 찾고자 한다.

---

## 4. 유스케이스 명세

### US-1: 랭킹 조회

**사용자 스토리:**

구매자로서 인기 상품 랭킹을 조회하고 싶다. 그래야 인기 있는 상품 중에서 구매할 상품을 탐색할 수 있다.

**인수 조건:**

1. 현재 시간대의 랭킹을 조회할 수 있다
2. 과거 시간대의 랭킹을 조회할 수 있다
3. 랭킹은 인기도 점수가 높은 순으로 정렬된다
4. 랭킹에 상품 정보(상품명, 가격, 재고, 좋아요 수)가 함께 제공된다
5. 한 번에 조회되는 상품 수를 지정할 수 있다
6. 다음 순위의 상품들을 이어서 조회할 수 있다
7. 해당 시간대에 데이터가 없으면 빈 목록을 반환한다

**예외 상황:**

1. 시간대 지정 형식이 잘못된 경우 시스템이 요청을 거부한다
2. 한 번에 조회할 상품 수가 허용 범위(1~100)를 벗어난 경우 시스템이 요청을 거부한다

---

### US-2: 상품 상세에서 순위 확인

**사용자 스토리:**

구매자로서 상품 상세를 볼 때 해당 상품의 현재 순위를 확인하고 싶다. 그래야 이 상품이 얼마나 인기 있는지 알 수 있다.

**인수 조건:**

1. 상품 상세 조회 시 현재 시간대의 순위가 함께 표시된다
2. 랭킹에 있는 상품은 1 이상의 순위를 가진다
3. 랭킹에 없는 상품은 순위가 없음으로 표시된다
4. 순위 조회에 실패해도 상품 정보는 정상 표시된다

**예외 상황:**

1. 존재하지 않는 상품을 조회한 경우 상품을 찾을 수 없다는 안내가 표시된다

---

### US-3: 가중치 조절

**사용자 스토리:**

관리자로서 항목별 가중치를 조절하고 싶다. 그래야 구매 전환을 최대화하는 최적의 가중치를 찾을 수 있다.

**인수 조건:**

1. 현재 적용 중인 가중치를 조회할 수 있다
2. 가중치가 설정되지 않은 경우 기본값이 표시된다
3. 조회, 좋아요, 주문 각각의 가중치를 변경할 수 있다
4. 가중치 변경 후 모든 상품의 인기도가 새 가중치로 재계산된다
5. 가중치 변경 결과가 랭킹에 반영된다

**예외 상황:**

1. 가중치가 0 미만이거나 1 초과인 경우 시스템이 요청을 거부한다
2. 관리자 권한이 없는 사용자가 변경을 시도한 경우 시스템이 요청을 거부한다

---

## 5. 비기능 요구사항

### 5.1 행동 반영 적시성

사용자의 조회, 좋아요, 주문 행동이 랭킹에 신속하게 반영되어야 한다. 사용자가 체감할 수 없는 수준의 지연은 허용된다.

**검증 기준:** 행동 발생 후 1분 이내에 랭킹에 반영된다.

### 5.2 가중치 변경 반영

관리자가 가중치를 변경하면 적절한 시간 내에 모든 상품의 인기도가 재계산되어야 한다.

**검증 기준:** 가중치 변경 후 5분 이내에 랭킹에 반영된다.

### 5.3 중복 행동 처리

같은 행동이 시스템에 중복으로 전달되어도 한 번만 집계되어야 한다.

**검증 시나리오:** 동일한 조회가 두 번 전달되어도 조회 횟수는 1회만 증가한다.

### 5.4 좋아요 취소 처리

좋아요 취소는 취소 시점의 시간대에서 차감된다.

**검증 시나리오:** 14시에 좋아요를 누르고 15시에 취소하면, 14시 시간대의 좋아요 수는 유지되고 15시 시간대의 좋아요 수가 감소한다. 이로 인해 15시 시간대의 좋아요 수가 음수가 될 수 있으며, 이는 정상적인 동작이다.

### 5.5 시스템 안정성

시스템이 종료되어도 아직 반영되지 않은 행동 데이터가 유실되지 않아야 한다.

**검증 시나리오:** 상품을 100회 조회한 직후 시스템을 종료하고 재시작하면, 해당 100회 조회가 랭킹에 반영되어 있다.

### 5.6 기본값 동작

가중치가 설정되지 않은 상태에서도 랭킹 시스템이 정상 동작해야 한다.

**검증 시나리오:** 가중치를 한 번도 설정하지 않은 상태에서 상품을 조회하고 랭킹을 확인하면, 기본 가중치가 적용된 인기도 점수가 표시된다.

### 5.7 장애 격리

랭킹 시스템에 장애가 발생해도 상품 조회 기능은 정상 동작해야 한다.

**검증 시나리오:** 랭킹 시스템 장애 상황에서 상품 상세를 조회하면, 상품 정보는 정상 표시되고 순위만 없음으로 표시된다.

### 5.8 응답 속도

랭킹 조회와 순위 확인 시 사용자가 대기한다고 느끼지 않아야 한다.

**검증 기준:** 랭킹 조회 API 응답 시간 p95 50ms 이하. 순위 조회(상품 상세 내) API 응답 시간 p95 10ms 이하.

---

## 6. 검증 시나리오

### 6.1 기본 랭킹 흐름

상품 A, B, C가 존재한다. 상품 A를 100회 조회하고, 상품 B에 좋아요 10개를 누르고, 상품 C로 10,000원 주문을 완료한다. 잠시 후 랭킹을 조회하면 인기도 순으로 정렬된다.

기본 가중치 적용 시 상품 C가 6,000점으로 1위, 상품 A가 10점으로 2위, 상품 B가 2점으로 3위가 된다.

### 6.2 시간대 전환

14시에 상품 A를 1,000회 조회한다. 14시 시간대에서 상품 A는 100점이다.

15시가 되면 15시 시간대가 시작되고, 상품 A는 이월된 10점에서 시작한다.

15시에 상품 A를 추가로 500회 조회하면 15시 시간대 점수는 60점(이월 10점 + 신규 50점)이 된다.

### 6.3 가중치 변경

기본 가중치 상태에서 상품 A가 조회 1,000회로 100점이다. 관리자가 조회 가중치를 0.10에서 0.50으로 변경한다. 잠시 후 상품 A의 점수가 500점으로 재계산된다.

### 6.4 좋아요와 취소

14시에 상품 A에 좋아요 5개를 누른다. 14시 시간대 좋아요 수는 5개이다.

15시에 좋아요 2개를 취소한다. 15시 시간대 좋아요 수는 -2개가 된다.

15시 시간대 인기도 계산 시 좋아요 -2개가 반영되어, 이월된 점수에서 좋아요 감소분만큼 차감된다.

### 6.5 동시 행동

같은 시간에 여러 사용자가 상품 A를 조회하고, 상품 B에 좋아요를 누르고, 상품 C를 주문한다. 모든 행동이 누락 없이 집계되어 랭킹에 반영된다.

### 6.6 랭킹 없는 상품

아무도 조회, 좋아요, 주문하지 않은 신규 상품 D가 있다. 상품 D의 상세를 조회하면 순위가 없음으로 표시된다. 랭킹 목록에는 상품 D가 포함되지 않는다.

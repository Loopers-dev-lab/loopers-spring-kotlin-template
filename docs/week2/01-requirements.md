# 감성 이커머스 서비스 요구사항 명세서

## 0. 개요
* 서비스명: 감성 이커머스 플랫폼
* 핵심 가치: 좋아요 기반 큐레이션, 포인트 결제, 브랜드 중심 쇼핑

---
## 1. 브랜드
### 1.1 유저 스토리
* 사용자는 특정 브랜드의 정보를 조회할 수 있다.
* 사용자는 다양한 조건으로 상품 목록을 조회할 수 있다.
* 사용자는 특정 상품의 상세 정보를 조회할 수 있다.

### 1.2 기능 명세
#### 1.2.1 브랜드 정보 조회 (GET `/api/v1/users`)
[Main Flow]
1. 클라이언트가 brandId를 포함하여 요청을 전송한다.
2. 시스템은 해당 브랜드 정보를 조회한다.
3. 브랜드 정보를 반환한다.

[Exception Flow]
* E1. brandId가 존재하지 않는 경우: 404 Not Found 반환
* E2. brandId 형식이 올바르지 않은 경우: 400 Bad Request 반환

---
## 2. 상품
### 2.1 유저 스토리
* 사용자는 다양한 조건으로 상품 목록을 조회할 수 있다.
* 사용자는 특정 상품의 상세 정보를 조회할 수 있다.
* 상품 정보에는 현재 좋아요 수가 포함되어야 한다.

### 2.2 기능 명세

#### 2.2.1 상품 목록 조회 (GET `/api/v1/products`)
[Main Flow]
1. 클라이언트가 필터/정렬/페이징 조건과 함께 요청을 전송한다.
2. 시스템은 조건에 맞는 상품 목록을 조회한다.
3. 각 상품의 좋아요 수를 포함하여 결과를 반환한다.

[Alternate Flow - 브랜드 필터링]
* brandId가 포함된 경우, 해당 브랜드의 상품만 조회한다.

[Exception Flow]
* E1. page 값이 음수인 경우: 400 Bad Request 반환
* E2. size 값이 1~100 범위를 벗어난 경우: 400 Bad Request 반환
* E3. sort 값이 유효하지 않은 경우: 400 Bad Request 반환

[Query Parameters]
* brandId (optional): 브랜드 ID로 필터링
* sort (optional): 정렬 기준 (기본값: latest)
    * latest: 최신순
    * price_asc: 낮은 가격순
    * likes_desc: 좋아요 많은 순
* page (optional): 페이지 번호 (기본값: 0)
* size (optional): 페이지 크기 (기본값: 20, 최대: 100)

#### 2.2.2 상품 상세 정보 조회 (GET `/api/v1/products/{productId}`)
[Main Flow]
1. 클라이언트가 productId를 포함하여 요청을 전송한다.
2. 시스템은 해당 상품의 상세 정보를 조회한다.
3. 상품 정보와 좋아요 수를 포함하여 반환한다.

[Alternate Flow - 로그인 사용자인 경우]
* X-USER-ID 헤더가 있는 경우, 해당 사용자의 좋아요 여부를 함께 조회한다.
* isLiked 필드를 true/false로 반환한다.

[Exception Flow]
* E1. productId 형식이 올바르지 않은 경우: 400 Bad Request 반환
* E2. 상품이 존재하지 않는 경우: 404 Not Found 반환

---
### 3. 좋아요
### 3.1 유저 스토리
* 사용자는 마음에 드는 상품에 좋아요를 누를 수 있다.
* 사용자는 이미 좋아요한 상품의 좋아요를 취소할 수 있다.
* 사용자는 자신이 좋아요한 상품 목록을 조회할 수 있다.
* 좋아요 등록/취소는 멱등하게 동작해야 한다.

### 3.2 기능 명세

### 3.2.1 상품 좋아요 등록 (POST `/api/v1/like/products/{productId}`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 productId를 포함하여 요청을 전송한다.
2. 시스템은 사용자와 상품의 존재 여부를 확인한다.
3. 시스템은 이미 좋아요가 존재하는지 확인한다.
4. 좋아요가 없는 경우, 좋아요를 생성하고 상품의 좋아요 수를 증가시킨다.
5. 좋아요 등록 성공 응답을 반환한다.

[Alternate Flow - 이미 좋아요가 존재하는 경우]
* 시스템은 이미 좋아요가 존재함을 확인한다.
* 추가 작업 없이 성공 응답을 반환한다. (멱등성 보장)

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. 사용자가 존재하지 않는 경우: 404 Not Found 반환
* E3. 상품이 존재하지 않는 경우: 404 Not Found 반환

[비즈니스 규칙]
* 한 사용자는 동일 상품에 대해 최대 1개의 좋아요만 가능
* 좋아요는 실시간으로 상품의 좋아요 수에 반영
* 동일 요청을 여러 번 보내도 결과는 동일 (멱등성)

### 3.2.2 상품 좋아요 취소 (DELETE `/api/v1/like/products/{productId}`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 productId를 포함하여 요청을 전송한다.
2. 시스템은 사용자와 상품의 존재 여부를 확인한다.
3. 시스템은 좋아요가 존재하는지 확인한다.
4. 좋아요가 있는 경우, 좋아요를 삭제하고 상품의 좋아요 수를 감소시킨다.
5. 좋아요 취소 성공 응답을 반환한다.

[Alternate Flow - 좋아요가 존재하지 않는 경우]
* 시스템은 좋아요가 존재하지 않음을 확인한다.
* 추가 작업 없이 성공 응답을 반환한다. (멱등성 보장)

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. 사용자가 존재하지 않는 경우: 404 Not Found 반환
* E3. 상품이 존재하지 않는 경우: 404 Not Found 반환

[비즈니스 규칙]
* 좋아요 취소는 실시간으로 상품의 좋아요 수에 반영
* 동일 요청을 여러 번 보내도 결과는 동일 (멱등성)

### 3.2.3 내가 좋아요 한 상품 목록 조회 (GET `/api/v1/like/products`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 함께 요청을 전송한다.
2. 시스템은 해당 사용자가 좋아요한 상품 목록을 조회한다.
3. 좋아요한 순서(최신순)로 정렬하여 반환한다.

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. 사용자가 존재하지 않는 경우: 404 Not Found 반환
* E3. page 값이 음수인 경우: 400 Bad Request 반환
* E4. size 값이 1~100 범위를 벗어난 경우: 400 Bad Request 반환

[Query Parameters]
* page (optional): 페이지 번호 (기본값: 0)
* size (optional): 페이지 크기 (기본값: 20, 최대: 100)

---
### 4. 주문
### 4.1 유저 스토리
* 사용자는 여러 상품을 한 번에 주문할 수 있다.
* 주문 시 보유 포인트로 결제가 자동으로 처리된다.
* 사용자는 자신의 주문 목록을 조회할 수 있다.
* 사용자는 특정 주문의 상세 정보를 조회할 수 있다.

### 4.2 기능 명세

#### 4.2.1 주문 요청 (POST `/api/v1/orders`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 주문 상품 목록을 포함하여 요청을 전송한다.
2. 시스템은 사용자의 존재 여부를 확인한다.
3. 시스템은 모든 상품의 존재 여부와 재고를 확인한다.
4. 시스템은 총 주문 금액을 계산한다.
5. 시스템은 사용자의 포인트가 충분한지 확인한다.
6. 시스템은 트랜잭션 내에서 다음을 수행한다:
   * 각 상품의 재고를 차감한다.
   * 사용자의 포인트를 차감한다.
   * 주문 정보를 생성한다.
   * 주문 상품 정보를 생성한다.
7. 주문 정보를 외부 시스템에 전송한다.
8. 주문 성공 응답을 반환한다.

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. 사용자가 존재하지 않는 경우: 404 Not Found 반환
* E3. 주문 상품 목록이 비어있는 경우: 400 Bad Request 반환
* E4. 상품이 존재하지 않는 경우: 404 Not Found 반환
* E5. 상품 재고가 부족한 경우: 409 Conflict 반환 (message: "상품 '{상품명}'의 재고가 부족합니다")
* E6. 수량이 0 이하인 경우: 400 Bad Request 반환
* E7. 보유 포인트가 부족한 경우: 400 Bad Request 반환 (message: "포인트가 부족합니다")

[비즈니스 규칙]
* 주문 최소 금액: 없음
* 1회 주문 최대 상품 종류: 100개
* 상품당 최대 수량: 999개
* 재고 차감, 포인트 차감, 주문 생성은 원자적으로 처리 (트랜잭션)
* 주문 실패 시 모든 변경사항 롤백

#### 4.2.2 주문 목록 조회 (GET `/api/v1/orders`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 함께 요청을 전송한다.
2. 시스템은 해당 사용자의 주문 목록을 조회한다.
3. 최신 주문순으로 정렬하여 반환한다.

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. 사용자가 존재하지 않는 경우: 404 Not Found 반환
* E3. page 값이 음수인 경우: 400 Bad Request 반환
* E4. size 값이 1~100 범위를 벗어난 경우: 400 Bad Request 반환

[Query Parameters]
* page (optional): 페이지 번호 (기본값: 0)
* size (optional): 페이지 크기 (기본값: 20, 최대: 100)

#### 4.2.3 주문 상세 조회 (GET `/api/v1/orders/{orderId}`)
[Main Flow]
1. 클라이언트가 X-USER-ID 헤더와 orderId를 포함하여 요청을 전송한다.
2. 시스템은 주문의 존재 여부를 확인한다.
3. 시스템은 해당 주문이 요청한 사용자의 주문인지 확인한다.
4. 주문 상세 정보를 반환한다.

[Exception Flow]
* E1. X-USER-ID 헤더가 없는 경우: 401 Unauthorized 반환
* E2. orderId가 존재하지 않는 경우: 404 Not Found 반환
* E3. 다른 사용자의 주문을 조회하려는 경우: 403 Forbidden 반환

---
## 5. 공통 사항

### 5.1 인증/인가
* 모든 API는 X-USER-ID 헤더로 사용자를 식별
* 실제 인증 시스템은 구현하지 않음
* X-USER-ID는 회원가입 시 등록한 ID / 없을 경우 비로그인 유저

### 5.2 Http Status Code
| **한국어**                   | **영어**   |
|---------------------------|----------|
| 200 OK                    | 성공       |
| 201 Created               | 생성 성공    |
| 400 Bad Request           | 잘못된 요청   |
| 401 Unauthorized          | 인증 정보 없음 |
| 403 Forbidden             | 권한 없음    |
| 404 Not Found             | 리소스 없음   |
| 500 Internal Server Error | 서버 오류    |
